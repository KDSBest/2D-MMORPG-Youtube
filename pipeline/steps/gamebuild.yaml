parameters:
- name: ACR
  type: string
  default: KDSMMORPGACR

steps:
- task: Docker@2
  displayName: Login to ACR
  inputs:
    command: login
    containerRegistry: ${{ parameters.ACR }}

- task: Docker@2
  displayName: LoginService Docker
  inputs:
    command: buildAndPush
    dockerfile: $(System.DefaultWorkingDirectory)/MMORPGServer/LoginService/Dockerfile
    buildContext: $(System.DefaultWorkingDirectory)/MMORPGServer/
    containerRegistry: ${{ parameters.ACR }}
    repository: loginservice
    tags: |
      latest
      $(Build.BuildNumber)

- task: Docker@2
  displayName: CharacterService Docker
  inputs:
    command: buildAndPush
    dockerfile: $(System.DefaultWorkingDirectory)/MMORPGServer/CharacterService/Dockerfile
    buildContext: $(System.DefaultWorkingDirectory)/MMORPGServer/
    containerRegistry: ${{ parameters.ACR }}
    repository: characterservice
    tags: |
      latest
      $(Build.BuildNumber)

- task: Docker@2
  displayName: WorldChatService Docker
  inputs:
    command: buildAndPush
    dockerfile: $(System.DefaultWorkingDirectory)/MMORPGServer/WorldChatService/Dockerfile
    buildContext: $(System.DefaultWorkingDirectory)/MMORPGServer/
    containerRegistry: ${{ parameters.ACR }}
    repository: worldchatservice
    tags: |
      latest
      $(Build.BuildNumber)

- task: Docker@2
  displayName: MapService Docker
  inputs:
    command: buildAndPush
    dockerfile: $(System.DefaultWorkingDirectory)/MMORPGServer/MapService/Dockerfile
    buildContext: $(System.DefaultWorkingDirectory)/MMORPGServer/
    containerRegistry: ${{ parameters.ACR }}
    repository: mapservice
    tags: |
      latest
      $(Build.BuildNumber)
